import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;
import java.sql.Statement;

public class 핸들러 {
    public static Connection connect(String ipp) {
        String classs = "com.microsoft.sqlserver.jdbc.SQLServerDriver";
        /* db : databse, username, password, conn : connection */
        String db = "jundb";
        String username = "cit";
        String password = "citcitcit";
        Connection conn = null;

        // connURL : 서버 접속시 필요한 ip주소, db 이름, 사용자 이름, 비밀번호
        String ConnURL = "jdbc:sqlserver://" + ipp + ";" +
                "databaseName=" + db + ";";
        try {
            Class.forName(classs);
            DriverManager.setLoginTimeout(1);
            // 연결을 한다
            conn = DriverManager.getConnection(ConnURL, username, password);
            System.out.println("연결 성공!");
        } catch (SQLException sqle) {
            System.out.println("SQLException : " + sqle);
        } catch (ClassNotFoundException cnfe) {
            System.out.println("ClassNotFoundException : " + cnfe);
        }

        catch (Exception e) {
            System.out.println("MSSQLhandler % connect " + e.getMessage() + " Exception");
        }
        return conn;
    }

    //cruid
    // create
    // read
    // update
    // insert
    // delete

    public static void drop(Connection conn, String tablename) {
        String query = "drop table " + tablename;
        try {
            Statement statement = conn.createStatement();
            statement.execute(query);
            System.out.println("테이블 삭제 성공 : " + tablename);
        }
        catch (SQLException sqle) {
            System.out.println(sqle);
        }
    }

    public static void create(Connection conn, String tablename, String[] cnames, String[] dtypes, String[] consts) {
        String query = "";
        for(int i=0; i<cnames.length; i++) {
            if(i == 0) {
                query += "CREATE TABLE " + tablename + " (";
            }
            query += cnames[i] + " " + dtypes[i] + " " + consts[i];
            if(i == cnames.length-1) {
                query += ")";
            }
            else {
                query += ", ";
            }
        }
        System.out.println(query);

        try {
            Statement statement = conn.createStatement();
            statement.execute(query);
            System.out.println("테이블 생성 성공 : " + tablename);
        }
        catch (SQLException sqle) {
            System.out.println(sqle);
        }
    }

    public static void main(String[] args) {
        String server = "1.168.0.53:60000";
        Connection conn = connect(server);

        String tablename = "tn_aphelios_builds";
        String cnames[] = {"core_builds", "pick_rates", "win_rates"};
        String dtypes[] = {"NVARCHAR(255)", "FLOAT", "FLOAT"};
        String consts[] = {"PRIMARY KEY", "NOT NULL", "NOT NULL"};

        create(conn, tablename, cnames, dtypes, consts);
        drop(conn, tablename);
    }
}
