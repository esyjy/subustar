import java.sql.*;

public class SQLHandler {
    String classs, db, username, password, ip, port;
    Connection conn;

    public SQLHandler(String db, String un, String pw, String ip, String port) {
        String classs = "com.microsoft.sqlserver.jdbc.SQLServerDriver";
        /* db : databse, username, password, conn : connection */
        this.db = db;
        this.username = username;
        this.password = password;
        this.ip = ip;
        this.port = port;
        this.conn = connect();
    }

    public Connection connect(String ip, String port) {
        // connURL : 서버 접속시 필요한 ip주소, db 이름, 사용자 이름, 비밀번호
        String ConnURL = "jdbc:sqlserver://" + ip + ":" + port + ";" +
                "databaseName=" + db + ";";
        try {
            Class.forName(classs);
            DriverManager.setLoginTimeout(1);
            // 연결을 한다
            conn = DriverManager.getConnection(ConnURL, username, password);
            System.out.println("연결 성공!");
        } catch (SQLException sqle) {
            System.out.println("SQLException : " + sqle);
        } catch (ClassNotFoundException cnfe) {
            System.out.println("ClassNotFoundException : " + cnfe);
        }

        catch (Exception e) {
            System.out.println("MSSQLhandler % connect " + e.getMessage() + " Exception");
        }
        return conn;
    }

    //cruid
    // create
    // read
    // update
    // insert
    // delete

    public void drop(Connection conn, String tablename) {
        String query = "drop table " + tablename;
        try {
            Statement statement = conn.createStatement();
            statement.execute(query);
            System.out.println("테이블 삭제 성공 : " + tablename);
        }
        catch (SQLException sqle) {
            System.out.println(sqle);
        }
    }

    public void read(Connection conn, String tablename, String where) {
        String query = "select * from " + tablename + where;
        ResultSet rs;
        try {
            Statement statement = conn.createStatement();
            rs = statement.executeQuery(query);
            while (rs.next()) {
                System.out.print(rs.getString(1) + " ");
                System.out.print(rs.getInt(2) + " ");
                System.out.print(rs.getInt(3) + " ");
                System.out.println(rs.getString(4) + " ");
            }
        }
        catch (SQLException sqle) {
            System.out.println(sqle);
        }
    }

    public void update(Connection conn, String tablename, String column, String value, String where) {
        String query = "update " + tablename + " set " + column + " = " + value + where;
        try {
            Statement statement = conn.createStatement();
            statement.execute(query);
            System.out.println("테이블 업데이트 성공 : " + tablename);
        }
        catch (SQLException sqle) {
            System.out.println(sqle);
        }
    }

    public void insert(Connection conn, String tablename, String values) {
        String query = "insert into " + tablename + " values (" + values + ")";
        try {
            Statement statement = conn.createStatement();
            statement.execute(query);
            System.out.println("테이블 값 추가 성공 : " + tablename);
        }
        catch (SQLException sqle) {
            System.out.println(sqle);
        }
    }

    public void create(Connection conn, String tablename, String[] cnames, String[] dtypes, String[] consts) {
        String query = "";
        for(int i=0; i<cnames.length; i++) {
            if(i == 0) {
                query += "CREATE TABLE " + tablename + " (";
            }
            query += cnames[i] + " " + dtypes[i] + " " + consts[i];
            if(i == cnames.length-1) {
                query += ")";
            }
            else {
                query += ", ";
            }
        }
        System.out.println(query);

        try {
            Statement statement = conn.createStatement();
            statement.execute(query);
            System.out.println("테이블 생성 성공 : " + tablename);
        }
        catch (SQLException sqle) {
            System.out.println(sqle);
        }
    }
}
